# âœ… ç¼–è¯‘å‰æœ€åæ£€æŸ¥

## å·²ä¿®å¤çš„é—®é¢˜

1. âœ… **FLOATING_POINT å®šä¹‰**
   - arch.h ç°åœ¨æ— æ¡ä»¶åŒ…å« config.h
   - config.h ä½¿ç”¨é˜²æŠ¤å®ç¡®ä¿ FLOATING_POINT=1

2. âœ… **å¤´æ–‡ä»¶è·¯å¾„**
   - å·²è°ƒæ•´ä¸º SpeexDSP/speex/ ç»“æ„

3. âœ… **reset å‡½æ•°ä¸å­˜åœ¨**
   - å·²æ”¹ç”¨é‡æ–°åˆå§‹åŒ–

---

## ğŸ¯ Xcode å¿…é¡»æ“ä½œ

### æ­¥éª¤ 1: ç§»é™¤æµ‹è¯•æ–‡ä»¶

åœ¨ **Build Phases** â†’ **Compile Sources** ä¸­ï¼Œåˆ é™¤è¿™äº›æ–‡ä»¶ï¼š

âŒ åˆ é™¤ï¼š
- `testresample2.c`
- `testresample.c`  
- `testdenoise.c`
- `testecho.c`
- `testjitter.c`
- `scal.c`

âœ… ä¿ç•™è¿™ 10 ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼š
1. `preprocess.c`
2. `mdf.c`
3. `resample.c`
4. `kiss_fft.c`
5. `kiss_fftr.c`
6. `fftwrap.c`
7. `filterbank.c`
8. `buffer.c`
9. `jitter.c`
10. `smallft.c`

### æ­¥éª¤ 2: ç¡®è®¤ Build Settings

**Build Settings** â†’ æœç´¢ **Other C Flags**

ç¡®ä¿åŒ…å«ï¼ˆå¯é€‰ï¼Œconfig.h å·²å¤„ç†ï¼‰ï¼š
```
-DHAVE_CONFIG_H
-DFLOATING_POINT=1
-DUSE_KISS_FFT=1
```

å¦‚æœå·²ç»åœ¨ config.h ä¸­å®šä¹‰ï¼Œè¿™äº›æ ‡å¿—æ˜¯å¯é€‰çš„ã€‚

### æ­¥éª¤ 3: Clean Build

1. `Cmd + Shift + K` - Clean Build Folder
2. `Cmd + B` - Build

---

## ğŸ” å¦‚ä½•ç¡®è®¤æµ‹è¯•æ–‡ä»¶å·²åˆ é™¤

åœ¨ç»ˆç«¯æ‰§è¡Œï¼š
```bash
cd AudioSampleBuffer/Karaoke/DSP/SpeexDSP
ls test*.c scal.c 2>/dev/null || echo "âœ… æµ‹è¯•æ–‡ä»¶å·²åˆ é™¤"
```

åº”è¯¥æ˜¾ç¤ºï¼š`âœ… æµ‹è¯•æ–‡ä»¶å·²åˆ é™¤`

---

## ğŸ“‹ æ ¸å¿ƒæ–‡ä»¶æ¸…å•

å¦‚éœ€æŸ¥çœ‹å½“å‰çš„æºæ–‡ä»¶ï¼š
```bash
cd AudioSampleBuffer/Karaoke/DSP/SpeexDSP  
ls *.c
```

åº”è¯¥åªæ˜¾ç¤º 10 ä¸ªæ–‡ä»¶ï¼š
```
buffer.c
fftwrap.c
filterbank.c
jitter.c
kiss_fft.c
kiss_fftr.c
mdf.c
preprocess.c
resample.c
smallft.c
```

---

## âœ¨ ç¼–è¯‘æˆåŠŸå

å¦‚æœç¼–è¯‘æˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
Build Succeeded
```

ç„¶åå¯ä»¥å¼€å§‹ä½¿ç”¨ SpeexDSP åŠŸèƒ½ï¼š

```objective-c
// åœ¨ VoiceEffectProcessor.mm ä¸­
#import "SpeexDSPBridge.h"

// åˆå§‹åŒ–
int frameSize = (int)(sampleRate * 0.005);  // 5ms
self.speexPreprocessor = [[SpeexPreprocessor alloc] initWithFrameSize:frameSize 
                                                           sampleRate:(int)sampleRate];

// é…ç½® AGC
[self.speexPreprocessor setAGCEnabled:YES];
[self.speexPreprocessor setAGCLevel:12000];
[self.speexPreprocessor setAGCMaxGain:25];

// å¤„ç†éŸ³é¢‘
float vadProb = [self.speexPreprocessor processSamples:buffer count:sampleCount];
```

---

## ğŸš¨ å¦‚æœä»æœ‰é”™è¯¯

### é”™è¯¯: "FLOATING_POINT not defined"
**è§£å†³:** åœ¨ Build Settings â†’ Other C Flags æ‰‹åŠ¨æ·»åŠ ï¼š
```
-DFLOATING_POINT=1
```

### é”™è¯¯: "test*.c file not found"
**è§£å†³:** åœ¨ Build Phases â†’ Compile Sources ä¸­æ‰‹åŠ¨åˆ é™¤è¿™äº›æ–‡ä»¶çš„å¼•ç”¨

### é”™è¯¯: "config.h not found"
**è§£å†³:** ç¡®ä¿ config.h åœ¨ SpeexDSP ç›®å½•ä¸­ï¼Œå¹¶ä¸”å·²æ·»åŠ åˆ° Xcode é¡¹ç›®

---

ç°åœ¨æ‰§è¡Œï¼š
1. âœ… ç§»é™¤æµ‹è¯•æ–‡ä»¶ï¼ˆBuild Phasesï¼‰
2. âœ… Clean Build (`Cmd + Shift + K`)
3. âœ… Build (`Cmd + B`)

åº”è¯¥æˆåŠŸç¼–è¯‘ï¼ğŸ‰
